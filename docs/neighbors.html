---

title: Code


keywords: fastai
sidebar: home_sidebar



nb_path: "notebooks_dev\neighbors.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks_dev\neighbors.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>C:\Users\User Ambev\Desktop\MyPackages\heartwood\heartwood\utils.py:20: UserWarning: could not load sparse_dot_topn: No module named &#39;sparse_dot_topn&#39;
  warn(f&#39;could not load sparse_dot_topn: {e}&#39;)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="NMSLibSklearnWrapper" class="doc_header"><code>class</code> <code>NMSLibSklearnWrapper</code><a href="https://github.com/AlanGanem/heartwood/tree/master/heartwood/neighbors.py#L20" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>NMSLibSklearnWrapper</code>(<strong><code>nmslib_method</code></strong>=<em><code>'hnsw'</code></em>, <strong><code>nmslib_space</code></strong>=<em><code>'jaccard_sparse'</code></em>, <strong><code>nmslib_data_type</code></strong>=<em><code>&lt;DataType.OBJECT_AS_STRING: 3&gt;</code></em>, <strong><code>nmslib_dtype</code></strong>=<em><code>&lt;DistType.FLOAT: 0&gt;</code></em>, <strong><code>nmslib_space_params</code></strong>=<em><code>{}</code></em>, <strong><code>index_time_params</code></strong>=<em><code>{'M': 30, 'indexThreadQty': 4, 'efConstruction': 100, 'post': 0}</code></em>, <strong><code>query_time_params</code></strong>=<em><code>{'efSearch': 100}</code></em>, <strong><code>n_neighbors</code></strong>=<em><code>30</code></em>, <strong><code>verbose</code></strong>=<em><code>False</code></em>, <strong><code>X_prep_function</code></strong>=<em><code>None</code></em>) :: <code>BaseEstimator</code></p>
</blockquote>
<p>Generic wrapper for nmslib nearest neighbors under sklearn NN API.
for distance types avalible, refer to <a href="https://github.com/nmslib/nmslib/blob/master/manual/spaces.md">https://github.com/nmslib/nmslib/blob/master/manual/spaces.md</a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FastJaccardNN" class="doc_header"><code>class</code> <code>FastJaccardNN</code><a href="https://github.com/AlanGanem/heartwood/tree/master/heartwood/neighbors.py#L224" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FastJaccardNN</code>(<strong><code>n_neighbors</code></strong>=<em><code>30</code></em>, <strong><code>index_time_params</code></strong>=<em><code>{'M': 30, 'indexThreadQty': 4, 'efConstruction': 100, 'post': 0}</code></em>, <strong><code>query_time_params</code></strong>=<em><code>{'efSearch': 100}</code></em>, <strong><code>verbose</code></strong>=<em><code>False</code></em>) :: <a href="/heartwood/neighbors.html#NMSLibSklearnWrapper"><code>NMSLibSklearnWrapper</code></a></p>
</blockquote>
<p>Generic wrapper for nmslib nearest neighbors under sklearn NN API.
for distance types avalible, refer to <a href="https://github.com/nmslib/nmslib/blob/master/manual/spaces.md">https://github.com/nmslib/nmslib/blob/master/manual/spaces.md</a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FastL2NN" class="doc_header"><code>class</code> <code>FastL2NN</code><a href="https://github.com/AlanGanem/heartwood/tree/master/heartwood/neighbors.py#L250" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FastL2NN</code>(<strong><code>n_neighbors</code></strong>=<em><code>30</code></em>, <strong><code>index_time_params</code></strong>=<em><code>{'M': 30, 'indexThreadQty': 8, 'efConstruction': 100, 'post': 0}</code></em>, <strong><code>query_time_params</code></strong>=<em><code>{'efSearch': 100}</code></em>, <strong><code>verbose</code></strong>=<em><code>False</code></em>) :: <a href="/heartwood/neighbors.html#NMSLibSklearnWrapper"><code>NMSLibSklearnWrapper</code></a></p>
</blockquote>
<p>Generic wrapper for nmslib nearest neighbors under sklearn NN API.
for distance types avalible, refer to <a href="https://github.com/nmslib/nmslib/blob/master/manual/spaces.md">https://github.com/nmslib/nmslib/blob/master/manual/spaces.md</a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="FastKLDivNN" class="doc_header"><code>class</code> <code>FastKLDivNN</code><a href="https://github.com/AlanGanem/heartwood/tree/master/heartwood/neighbors.py#L277" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>FastKLDivNN</code>(<strong><code>n_neighbors</code></strong>=<em><code>30</code></em>, <strong><code>index_time_params</code></strong>=<em><code>{'M': 30, 'indexThreadQty': 4, 'efConstruction': 100, 'post': 0}</code></em>, <strong><code>query_time_params</code></strong>=<em><code>{'efSearch': 100}</code></em>, <strong><code>verbose</code></strong>=<em><code>False</code></em>) :: <a href="/heartwood/neighbors.html#NMSLibSklearnWrapper"><code>NMSLibSklearnWrapper</code></a></p>
</blockquote>
<p>Generic wrapper for nmslib nearest neighbors under sklearn NN API.
for distance types avalible, refer to <a href="https://github.com/nmslib/nmslib/blob/master/manual/spaces.md">https://github.com/nmslib/nmslib/blob/master/manual/spaces.md</a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">joblib</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;terminal_node_embs&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">jcd</span> <span class="o">=</span> <span class="n">FastJaccardNN</span><span class="p">(</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">jcd</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">jcd</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">n_jobs</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>kNN time total=1.559384 (sec), per query=0.000078 (sec), per query adjusted for thread number=0.000624 (sec)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">jcd</span><span class="p">,</span><span class="s1">&#39;jcd.sav&#39;</span><span class="p">)</span>
<span class="n">jcd</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;jcd.sav&#39;</span><span class="p">)</span>
<span class="c1">#appends to index</span>
<span class="n">jcd</span><span class="o">.</span><span class="n">partial_fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">jcd</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">n_jobs</span> <span class="o">=</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>kNN time total=2.845731 (sec), per query=0.000095 (sec), per query adjusted for thread number=0.000759 (sec)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000000</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">l2nn</span> <span class="o">=</span> <span class="n">FastL2NN</span><span class="p">(</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">l2nn</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>kNN time total=30.717137 (sec), per query=0.000031 (sec), per query adjusted for thread number=0.000123 (sec)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Export">Export<a class="anchor-link" href="#Export"> </a></h1>
</div>
</div>
</div>
</div>
 

